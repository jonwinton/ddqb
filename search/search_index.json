{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"DDQB \u2014 DataDog Query Builder","text":"<p>DDQB is a Go library for constructing and parsing DataDog metric queries with a chainable API and type safety.</p> <ul> <li>\ud83e\uddf1 Chainable builder for metrics, filters, functions, rollups, and groups  </li> <li>\ud83d\udd0d Parse existing queries and modify them programmatically  </li> <li>\ud83e\uddea Type-safe composition without string concatenation  </li> <li>\ud83e\udded Clear primitives for constructing complex queries  </li> </ul>"},{"location":"#quick-links","title":"Quick links","text":"<ul> <li>Examples \u2192 examples.md </li> <li>API Reference \u2192 api.md (generated by CI)</li> </ul>"},{"location":"#install","title":"Install","text":"<pre><code>go get github.com/jonwinton/ddqb\n</code></pre>"},{"location":"#minimal-example","title":"Minimal example","text":"<pre><code>import (\n  \"fmt\"\n  \"github.com/jonwinton/ddqb\"\n)\n\nfunc main() {\n  q, err := ddqb.Metric().\n    Metric(\"system.cpu.idle\").\n    Build()\n  if err != nil { panic(err) }\n  fmt.Println(q)\n}\n</code></pre>"},{"location":"#common-patterns","title":"Common patterns","text":""},{"location":"#aggregation-window","title":"Aggregation + window","text":"<pre><code>q, _ := ddqb.Metric().\n  Aggregator(\"avg\").\n  TimeWindow(\"5m\").\n  Metric(\"system.cpu.idle\").\n  Build()\n</code></pre>"},{"location":"#filters-groups-functions","title":"Filters, groups, functions","text":"<pre><code>q, _ := ddqb.Metric().\n  Metric(\"system.cpu.idle\").\n  Filter(ddqb.Filter(\"host\").Equal(\"web-1\")).\n  Filter(ddqb.Filter(\"env\").Equal(\"prod\")).\n  GroupBy(\"host\").\n  ApplyFunction(ddqb.Function(\"rollup\").WithArgs(\"60\", \"sum\")).\n  Build()\n</code></pre>"},{"location":"#parse-and-modify-an-existing-query","title":"Parse and modify an existing query","text":"<pre><code>import (\n  \"fmt\"\n  \"github.com/jonwinton/ddqb\"\n)\n\nfunc main() {\n  b, err := ddqb.FromQuery(\"avg(5m):system.cpu.idle{host:web-1}\")\n  if err != nil { panic(err) }\n  q, err := b.\n    TimeWindow(\"10m\").\n    Filter(ddqb.Filter(\"env\").Equal(\"prod\")).\n    Build()\n  if err != nil { panic(err) }\n  fmt.Println(q)\n}\n</code></pre>"},{"location":"api/","title":"API","text":""},{"location":"api/#ddqb","title":"ddqb","text":"<pre><code>import \"github.com/jonwinton/ddqb\"\n</code></pre> <p>Package ddqb provides a fluent API for building Datadog queries.</p> <p>Package ddqb provides a fluent API for building Datadog queries.</p> Example <p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/jonwinton/ddqb\"\n)\n\nfunc main() {\n    // Create a simple metric query\n    query, err := ddqb.Metric().\n        Metric(\"system.cpu.idle\").\n        Build()\n    if err != nil {\n        log.Fatalf(\"Failed to build query: %v\", err)\n    }\n    fmt.Println(query)\n\n    // Create a metric query with aggregation\n    query, err = ddqb.Metric().\n        Aggregator(\"avg\").\n        TimeWindow(\"5m\").\n        Metric(\"system.cpu.idle\").\n        Build()\n    if err != nil {\n        log.Fatalf(\"Failed to build query: %v\", err)\n    }\n    fmt.Println(query)\n\n    // Create a metric query with filtering\n    query, err = ddqb.Metric().\n        Metric(\"system.cpu.idle\").\n        Filter(ddqb.Filter(\"host\").Equal(\"web-1\")).\n        Build()\n    if err != nil {\n        log.Fatalf(\"Failed to build query: %v\", err)\n    }\n    fmt.Println(query)\n\n    // Create a complex metric query\n    query, err = ddqb.Metric().\n        Aggregator(\"avg\").\n        TimeWindow(\"5m\").\n        Metric(\"system.cpu.idle\").\n        Filter(ddqb.Filter(\"host\").Equal(\"web-1\")).\n        Filter(ddqb.Filter(\"env\").Equal(\"prod\")).\n        GroupBy(\"host\").\n        ApplyFunction(ddqb.Function(\"fill\").WithArg(\"0\")).\n        ApplyFunction(ddqb.Function(\"rollup\").WithArgs(\"60\", \"sum\")).\n        Build()\n    if err != nil {\n        log.Fatalf(\"Failed to build query: %v\", err)\n    }\n    fmt.Println(query)\n\n}\n</code></pre>  #### Output  <pre><code>system.cpu.idle{*}\navg(5m):system.cpu.idle{*}\nsystem.cpu.idle{host:web-1}\navg(5m):system.cpu.idle{host:web-1, env:prod} by {host}.fill(0).rollup(60, sum)\n</code></pre> </p>"},{"location":"api/#index","title":"Index","text":"<ul> <li>func Filter(key string) metric.FilterBuilder</li> <li>func FilterGroup() metric.FilterGroupBuilder</li> <li>func FromQuery(queryString string) (metric.QueryBuilder, error)</li> <li>func Function(name string) metric.FunctionBuilder</li> <li>func Metric() metric.QueryBuilder</li> <li>type Builder</li> <li>type Renderer</li> </ul>"},{"location":"api/#func-filter","title":"func Filter","text":"<pre><code>func Filter(key string) metric.FilterBuilder\n</code></pre> <p>Filter creates a new filter builder with the given key. This is a convenience function for creating filter builders.</p> <p></p>"},{"location":"api/#func-filtergroup","title":"func FilterGroup","text":"<pre><code>func FilterGroup() metric.FilterGroupBuilder\n</code></pre> <p>FilterGroup creates a new filter group builder. This is a convenience function for creating filter group builders.</p> <p></p>"},{"location":"api/#func-fromquery","title":"func FromQuery","text":"<pre><code>func FromQuery(queryString string) (metric.QueryBuilder, error)\n</code></pre> <p>FromQuery parses an existing Datadog query string and returns a QueryBuilder that can be modified using the fluent API.</p> <p>Example:</p> <pre><code>builder, err := ddqb.FromQuery(\"avg(5m):system.cpu.idle{host:web-1} by {host}.fill(0)\")\nif err != nil {\n    // handle error\n}\nmodifiedQuery, err := builder.TimeWindow(\"10m\").Filter(ddqb.Filter(\"env\").Equal(\"prod\")).Build()\n</code></pre> <p></p>"},{"location":"api/#func-function","title":"func Function","text":"<pre><code>func Function(name string) metric.FunctionBuilder\n</code></pre> <p>Function creates a new function builder with the given name. This is a convenience function for creating function builders.</p> <p></p>"},{"location":"api/#func-metric","title":"func Metric","text":"<pre><code>func Metric() metric.QueryBuilder\n</code></pre> <p>Metric creates a new metric query builder. This is the main entry point for building metric queries.</p> <p></p>"},{"location":"api/#type-builder","title":"type Builder","text":"<p>Builder is the base interface for all query builders. It defines the methods that all builders must implement.</p> <pre><code>type Builder interface {\n    // Build returns the built query as a string.\n    Build() (string, error)\n}\n</code></pre> <p></p>"},{"location":"api/#type-renderer","title":"type Renderer","text":"<p>Renderer defines an interface for objects that can render themselves as Datadog query strings.</p> <pre><code>type Renderer interface {\n    // String returns the object as a Datadog query string.\n    String() string\n}\n</code></pre>"},{"location":"api/#metric","title":"metric","text":"<pre><code>import \"github.com/jonwinton/ddqb/metric\"\n</code></pre> <p>Package metric provides builders for creating Datadog metric queries.</p>"},{"location":"api/#index_1","title":"Index","text":"<ul> <li>type FilterBuilder</li> <li>func NewFilterBuilder(key string) FilterBuilder</li> <li>type FilterExpression</li> <li>type FilterGroupBuilder</li> <li>func NewFilterGroupBuilder() FilterGroupBuilder</li> <li>type FilterOperation</li> <li>type FunctionBuilder</li> <li>func NewFunctionBuilder(name string) FunctionBuilder</li> <li>type GroupOperator</li> <li>type QueryBuilder</li> <li>func NewMetricQueryBuilder() QueryBuilder</li> <li>func ParseQuery(queryString string) (QueryBuilder, error)</li> </ul>"},{"location":"api/#type-filterbuilder","title":"type FilterBuilder","text":"<p>FilterBuilder provides a fluent interface for building filter conditions. FilterBuilder implements FilterExpression.</p> <pre><code>type FilterBuilder interface {\n    FilterExpression\n\n    // Equal creates an equality filter (key:value).\n    Equal(value string) FilterBuilder\n\n    // NotEqual creates a negated equality filter (!key:value).\n    NotEqual(value string) FilterBuilder\n\n    // In creates an IN filter.\n    In(values ...string) FilterBuilder\n\n    // NotIn creates a NOT IN filter.\n    NotIn(values ...string) FilterBuilder\n}\n</code></pre> <p></p>"},{"location":"api/#func-newfilterbuilder","title":"func NewFilterBuilder","text":"<pre><code>func NewFilterBuilder(key string) FilterBuilder\n</code></pre> <p>NewFilterBuilder creates a new filter builder with the given key.</p> <p></p>"},{"location":"api/#type-filterexpression","title":"type FilterExpression","text":"<p>FilterExpression is a common interface for both individual filters and filter groups. This allows QueryBuilder to accept either FilterBuilder or FilterGroupBuilder instances.</p> <pre><code>type FilterExpression interface {\n    // Build returns the built filter expression as a string.\n    Build() (string, error)\n}\n</code></pre> <p></p>"},{"location":"api/#type-filtergroupbuilder","title":"type FilterGroupBuilder","text":"<p>FilterGroupBuilder provides a fluent interface for building filter groups with boolean logic. FilterGroupBuilder implements FilterExpression.</p> <pre><code>type FilterGroupBuilder interface {\n    FilterExpression\n\n    // And adds a filter or nested group with AND operator.\n    And(expr FilterExpression) FilterGroupBuilder\n\n    // Or adds a filter or nested group with OR operator.\n    Or(expr FilterExpression) FilterGroupBuilder\n\n    // Not negates the entire group (wraps in NOT (...)).\n    Not() FilterGroupBuilder\n}\n</code></pre> <p></p>"},{"location":"api/#func-newfiltergroupbuilder","title":"func NewFilterGroupBuilder","text":"<pre><code>func NewFilterGroupBuilder() FilterGroupBuilder\n</code></pre> <p>NewFilterGroupBuilder creates a new filter group builder.</p> <p></p>"},{"location":"api/#type-filteroperation","title":"type FilterOperation","text":"<p>FilterOperation represents the type of filter operation.</p> <pre><code>type FilterOperation int\n</code></pre> <p></p> <pre><code>const (\n    // Equal represents an equality filter (key:value).\n    Equal FilterOperation = iota\n    // NotEqual represents a negated equality filter (!key:value).\n    NotEqual\n    // In represents an IN filter.\n    In\n    // NotIn represents a NOT IN filter.\n    NotIn\n)\n</code></pre> <p></p>"},{"location":"api/#type-functionbuilder","title":"type FunctionBuilder","text":"<p>FunctionBuilder provides a fluent interface for building functions to apply to queries.</p> <pre><code>type FunctionBuilder interface {\n    // WithArg adds an argument to the function.\n    WithArg(arg string) FunctionBuilder\n\n    // WithArgs adds multiple arguments to the function.\n    WithArgs(args ...string) FunctionBuilder\n\n    // Build returns the built function as a string.\n    Build() (string, error)\n}\n</code></pre> <p></p>"},{"location":"api/#func-newfunctionbuilder","title":"func NewFunctionBuilder","text":"<pre><code>func NewFunctionBuilder(name string) FunctionBuilder\n</code></pre> <p>NewFunctionBuilder creates a new function builder with the given name.</p> <p></p>"},{"location":"api/#type-groupoperator","title":"type GroupOperator","text":"<p>GroupOperator represents the boolean operator used in a filter group.</p> <pre><code>type GroupOperator int\n</code></pre> <p></p> <pre><code>const (\n    // AndOperator represents an AND operation between filters.\n    AndOperator GroupOperator = iota\n    // OrOperator represents an OR operation between filters.\n    OrOperator\n)\n</code></pre> <p></p>"},{"location":"api/#type-querybuilder","title":"type QueryBuilder","text":"<p>QueryBuilder provides a fluent interface for building metric queries.</p> <pre><code>type QueryBuilder interface {\n    // Metric sets the metric name for the query.\n    Metric(name string) QueryBuilder\n\n    // Aggregator sets the aggregation method for the query (e.g., \"avg\", \"sum\").\n    Aggregator(agg string) QueryBuilder\n\n    // Filter adds a filter condition or filter group to the query.\n    Filter(filter FilterExpression) QueryBuilder\n\n    // GetFilters returns all filter expressions in the query.\n    // This allows direct access to modify FilterGroupBuilder instances.\n    GetFilters() []FilterExpression\n\n    // FindGroup finds the first FilterGroupBuilder that matches the predicate function.\n    // Returns nil if no matching group is found.\n    FindGroup(predicate func(FilterGroupBuilder) bool) FilterGroupBuilder\n\n    // AddToGroup adds a filter to the specified FilterGroupBuilder.\n    // The filter is added using the group's existing operator (AND or OR).\n    AddToGroup(group FilterGroupBuilder, filter FilterExpression) QueryBuilder\n\n    // GroupBy sets grouping parameters for the query.\n    GroupBy(groups ...string) QueryBuilder\n\n    // ApplyFunction applies a function to the query.\n    ApplyFunction(fn FunctionBuilder) QueryBuilder\n\n    // TimeWindow sets the time window for the query (e.g., \"1m\", \"5m\").\n    TimeWindow(window string) QueryBuilder\n\n    // Build returns the built query as a string.\n    Build() (string, error)\n}\n</code></pre> <p></p>"},{"location":"api/#func-newmetricquerybuilder","title":"func NewMetricQueryBuilder","text":"<pre><code>func NewMetricQueryBuilder() QueryBuilder\n</code></pre> <p>NewMetricQueryBuilder creates a new metric query builder.</p> <p></p>"},{"location":"api/#func-parsequery","title":"func ParseQuery","text":"<pre><code>func ParseQuery(queryString string) (QueryBuilder, error)\n</code></pre> <p>ParseQuery parses a Datadog query string and returns a QueryBuilder that can be modified using the fluent API.</p>"},{"location":"api/#advanced","title":"advanced","text":"<pre><code>import \"github.com/jonwinton/ddqb/examples/advanced\"\n</code></pre> <p>Package main demonstrates advanced usage of ddqb, including dynamic query building based on runtime conditions.</p>"},{"location":"api/#index_2","title":"Index","text":""},{"location":"api/#basic","title":"basic","text":"<pre><code>import \"github.com/jonwinton/ddqb/examples/basic\"\n</code></pre> <p>Package main demonstrates basic usage examples of ddqb for building Datadog metric queries.</p>"},{"location":"api/#index_3","title":"Index","text":""},{"location":"api/#filters","title":"filters","text":"<pre><code>import \"github.com/jonwinton/ddqb/examples/filters\"\n</code></pre> <p>Package main demonstrates various filter operations available in ddqb for Datadog metric queries.</p>"},{"location":"api/#index_4","title":"Index","text":""},{"location":"api/#functions","title":"functions","text":"<pre><code>import \"github.com/jonwinton/ddqb/examples/functions\"\n</code></pre> <p>Package main demonstrates how to apply functions to Datadog metric queries using ddqb.</p>"},{"location":"api/#index_5","title":"Index","text":""},{"location":"api/#parse","title":"parse","text":"<pre><code>import \"github.com/jonwinton/ddqb/examples/parse\"\n</code></pre> <p>Package main demonstrates parsing existing Datadog query strings and modifying them using ddqb.</p>"},{"location":"api/#index_6","title":"Index","text":"<p>Generated by gomarkdoc</p>"},{"location":"examples/","title":"Examples","text":"<p>Two ways to use DDQB:</p> <p>1) Building queries from scratch 2) Parsing and updating existing queries</p>"},{"location":"examples/#1-building-queries-from-scratch","title":"1) Building queries from scratch","text":""},{"location":"examples/#a-simple-metric","title":"A. Simple metric","text":"<pre><code>q, err := ddqb.Metric().\n  Metric(\"system.cpu.idle\").\n  Build()\n</code></pre>"},{"location":"examples/#b-aggregation-time-window","title":"B. Aggregation + time window","text":"<pre><code>q, err := ddqb.Metric().\n  Aggregator(\"avg\").\n  TimeWindow(\"5m\").\n  Metric(\"system.cpu.idle\").\n  Build()\n</code></pre>"},{"location":"examples/#c-basic-filters-and-grouping","title":"C. Basic filters and grouping","text":"<pre><code>q, err := ddqb.Metric().\n  Metric(\"system.cpu.user\").\n  Filter(ddqb.Filter(\"env\").Equal(\"prod\")).\n  Filter(ddqb.Filter(\"service\").Equal(\"api\")).\n  GroupBy(\"host\", \"availability-zone\").\n  Build()\n</code></pre>"},{"location":"examples/#d-innot-in-and-notequal-filters","title":"D. IN/NOT IN, and NotEqual filters","text":"<pre><code>q, err := ddqb.Metric().\n  Metric(\"system.disk.in_use\").\n  Filter(ddqb.Filter(\"env\").NotEqual(\"staging\")).\n  Filter(ddqb.Filter(\"availability-zone\").In(\"us-east-1a\", \"us-east-1b\")).\n  Filter(ddqb.Filter(\"service\").NotIn(\"batch\", \"etl\")).\n  GroupBy(\"device\", \"host\").\n  Build()\n</code></pre>"},{"location":"examples/#e-functions-fill-rollup-as_rate-as_count","title":"E. Functions (fill, rollup, as_rate, as_count)","text":"<pre><code>q, err := ddqb.Metric().\n  Metric(\"nginx.net.request_per_s\").\n  ApplyFunction(ddqb.Function(\"fill\").WithArg(\"0\")).\n  ApplyFunction(ddqb.Function(\"rollup\").WithArgs(\"60\", \"sum\")).\n  ApplyFunction(ddqb.Function(\"as_rate\")).\n  Build()\n</code></pre>"},{"location":"examples/#f-explicit-boolean-logic-with-filter-groups","title":"F. Explicit boolean logic with filter groups","text":"<pre><code>group := ddqb.FilterGroup().\n  Or(ddqb.Filter(\"availability-zone\").Equal(\"us-east-1a\")).\n  Or(ddqb.Filter(\"availability-zone\").Equal(\"us-east-1c\"))\n\nq, err := ddqb.Metric().\n  Metric(\"system.cpu.user\").\n  Filter(ddqb.Filter(\"env\").Equal(\"staging\")).\n  Filter(group).\n  GroupBy(\"availability-zone\").\n  Build()\n</code></pre>"},{"location":"examples/#g-advanced-combined-example","title":"G. Advanced combined example","text":"<pre><code>complexGroup := ddqb.FilterGroup().\n  And(ddqb.Filter(\"team\").Equal(\"core\")).\n  And(\n    ddqb.FilterGroup().\n      Or(ddqb.Filter(\"service\").Equal(\"api\")).\n      Or(ddqb.Filter(\"service\").Equal(\"web\")),\n  )\n\nq, err := ddqb.Metric().\n  Aggregator(\"avg\").\n  TimeWindow(\"10m\").\n  Metric(\"system.mem.used\").\n  Filter(ddqb.Filter(\"env\").Equal(\"prod\")).\n  Filter(ddqb.Filter(\"region\").In(\"us-east-1\", \"us-west-2\")).\n  Filter(complexGroup).\n  GroupBy(\"service\", \"host\").\n  ApplyFunction(ddqb.Function(\"fill\").WithArg(\"0\")).\n  ApplyFunction(ddqb.Function(\"rollup\").WithArgs(\"300\", \"avg\")).\n  Build()\n</code></pre>"},{"location":"examples/#2-parsing-and-updating-queries","title":"2) Parsing and updating queries","text":""},{"location":"examples/#a-simple-parse-and-tweak","title":"A. Simple parse and tweak","text":"<pre><code>b, err := ddqb.FromQuery(\"avg(5m):system.cpu.idle{host:web-1}\")\nif err != nil { panic(err) }\n\nq, err := b.\n  TimeWindow(\"10m\").\n  Filter(ddqb.Filter(\"env\").Equal(\"prod\")).\n  Build()\n</code></pre>"},{"location":"examples/#b-add-grouping-and-functions","title":"B. Add grouping and functions","text":"<pre><code>b, err := ddqb.FromQuery(\"sum:nginx.net.request_per_s{service:shop} by {resource_name}\")\nif err != nil { panic(err) }\n\nq, err := b.\n  GroupBy(\"resource_name\", \"host\").\n  ApplyFunction(ddqb.Function(\"as_rate\")).\n  ApplyFunction(ddqb.Function(\"rollup\").WithArgs(\"120\", \"sum\")).\n  Build()\n</code></pre>"},{"location":"examples/#c-modify-boolean-groups-in-place","title":"C. Modify boolean groups in-place","text":"<pre><code>package main\n\nimport (\n  \"strings\"\n  \"github.com/jonwinton/ddqb\"\n  \"github.com/jonwinton/ddqb/metric\"\n)\n\nfunc main() {\n  // Start with a query using an OR group across AZs\n  start := \"avg:system.cpu.user{env:staging AND (availability-zone:us-east-1a OR availability-zone:us-east-1c)} by {availability-zone}\"\n  b, err := ddqb.FromQuery(start)\n  if err != nil { panic(err) }\n\n  // Find the OR group and add another AZ to it\n  g := b.FindGroup(func(gr metric.FilterGroupBuilder) bool {\n    built, _ := gr.Build()\n    return strings.Contains(built, \"availability-zone\")\n  })\n\n  b = b.AddToGroup(g, ddqb.Filter(\"availability-zone\").Equal(\"us-east-1b\"))\n\n  q, err := b.Build()\n  if err != nil { panic(err) }\n  _ = q\n}\n</code></pre>"},{"location":"examples/#d-complex-end-to-end-edits","title":"D. Complex end-to-end edits","text":"<pre><code>original := \"avg(5m):system.mem.used{env:prod, team:core} by {service}.fill(0).rollup(60, sum)\"\nb, err := ddqb.FromQuery(original)\nif err != nil { panic(err) }\n\n// Adjust aggregator window, add filters, and expand grouping\nq, err := b.\n  TimeWindow(\"15m\").\n  Filter(ddqb.Filter(\"region\").In(\"us-east-1\", \"us-west-2\")).\n  GroupBy(\"service\", \"host\").\n  ApplyFunction(ddqb.Function(\"as_rate\")).\n  Build()\n</code></pre>"}]}